<VirtualHost *:80>
    ServerName localhost
    DocumentRoot /var/www/html
    
    # Directory configuration for WordPress
    <Directory /var/www/html>
        Options -Indexes FollowSymLinks
        AllowOverride All
        Require all granted
        DirectoryIndex index.php index.html
        
        # Enable mod_rewrite for WordPress permalinks
        RewriteEngine On
        
        # WordPress permalink rules
        RewriteBase /
        RewriteRule ^index\.php$ - [L]
        RewriteCond %{REQUEST_FILENAME} !-f
        RewriteCond %{REQUEST_FILENAME} !-d
        RewriteRule . /index.php [L]
    </Directory>
    
    # Proxy configuration to PHP-FPM
    <FilesMatch \.php$>
        SetHandler "proxy:fcgi://php:9000"
    </FilesMatch>
    
    # Additional proxy settings for PHP-FPM
    ProxyPassMatch ^/(.*\.php(/.*)?)$ fcgi://php:9000/var/www/html/$1
    
    # Security headers
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options SAMEORIGIN
    Header always set X-XSS-Protection "1; mode=block"
    
    # Custom logging configuration
    LogLevel info
    ErrorLog /var/log/apache2/wordpress_error.log
    CustomLog /var/log/apache2/wordpress_access.log combined
    
    # Log format for better debugging
    LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\" %D" wordpress_combined
    CustomLog /var/log/apache2/wordpress_detailed.log wordpress_combined
</VirtualHost>
