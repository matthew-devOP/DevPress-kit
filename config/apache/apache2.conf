# Global Apache2 Configuration for WordPress
# This configuration is optimized for WordPress with PHP-FPM

# Basic server configuration
ServerRoot "/etc/apache2"
ServerName localhost
Listen 80

# Process and thread configuration
StartServers 2
MinSpareServers 6
MaxSpareServers 12
MaxRequestWorkers 30
ServerLimit 10

# Security settings
ServerTokens Prod
ServerSignature Off
TraceEnable Off

# Directory index files
DirectoryIndex index.php index.html

# MIME types
TypesConfig /etc/mime.types

# Include module configurations
Include /etc/apache2/conf-available/modules.conf

# Default charset
AddDefaultCharset UTF-8

# File upload limits (adjust as needed for WordPress)
LimitRequestBody 100M

# Timeout settings
Timeout 300
KeepAlive On
MaxKeepAliveRequests 100
KeepAliveTimeout 5

# Log configuration
ErrorLog /var/log/apache2/error.log
LogLevel warn

# Define log formats
LogFormat "%v:%p %h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" vhost_combined
LogFormat "%h %l %u %t \"%r\" %>s %O \"%{Referer}i\" \"%{User-Agent}i\"" combined
LogFormat "%h %l %u %t \"%r\" %>s %O" common
LogFormat "%{Referer}i -> %U" referer
LogFormat "%{User-agent}i" agent

# Security configurations
<Directory />
    Options -Indexes
    AllowOverride None
    Require all denied
</Directory>

<Directory /var/www/>
    Options -Indexes +FollowSymLinks
    AllowOverride None
    Require all granted
</Directory>

# Prevent access to .htaccess and other sensitive files
<FilesMatch "^\.">
    Require all denied
</FilesMatch>

# Prevent access to backup files
<FilesMatch "\.(bak|config|dist|fla|inc|ini|log|psd|sh|sql|swp)$">
    Require all denied
</FilesMatch>

# PHP-FPM proxy configuration
<Proxy "fcgi://php:9000/">
    ProxySet timeout=300
    ProxySet retry=5
    ProxySet connectiontimeout=10
</Proxy>

# Include site configurations
Include /etc/apache2/sites-enabled/*.conf
